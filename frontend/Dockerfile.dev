FROM node:18

WORKDIR /app

# Instala dependências iniciais (cacheável)
COPY package.json package-lock.json ./
RUN npm ci --silent

# Em desenvolvimento vamos montar o código por volume; o comando abaixo
# garante que as dependências sejam instaladas quando o container iniciar.
EXPOSE 4200

CMD ["sh", "-c", "npm install --no-audit --no-fund || true && npm run start -- --host 0.0.0.0 --port 4200"]
